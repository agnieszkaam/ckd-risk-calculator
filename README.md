markdown
# CKD Hospital Outcomes Risk Calculator (Prototype)

Streamlit app for a logistic-regression–based risk calculator estimating **in-hospital death** and **prolonged length of stay** among patients with chronic kidney disease (CKD). Research prototype to accompany a conference poster. **Not for clinical use.**

> **Disclosure:** This repository (including code and this README) were drafted with assistance from ChatGPT and then reviewed/edited by the author.

---

## Project structure

```

ckd-risk-calculator/
├─ .streamlit/
│  └─ config.toml          # optional Streamlit UI/theme config
├─ data/
│  └─ model\_coeffs.json    # REQUIRED: logistic model spec (see schema below)
├─ .gitignore
├─ app.py                  # Streamlit application
├─ README.md
├─ requirements.txt        # Python dependencies (e.g., streamlit)
└─ .venv/                  # (local virtual env; do not commit)

```

---

## Quick start

```bash
# 1) (Recommended) use a virtual environment
python -m venv .venv
source .venv/bin/activate        # Windows: .venv\Scripts\activate

# 2) Install dependencies
pip install -r requirements.txt  

# 3) Verify the model file exists
#    Required path: data/model_coeffs.json

# 4) Launch
streamlit run app.py
````

* Python 3.9+ recommended.
* The app opens in your browser and first verifies that the **primary diagnosis is CKD (ICD-10 N18.\*)** before collecting inputs.

---

## What the app does

* Computes risks for two outcomes using logistic regression:

  * **In-hospital death** (`death_in_hospital`)
  * **Prolonged length of stay** (`prolonged_los`, defined as **≥ 8 days**)
* Displays results as percentages with a compact, mobile-first UI.

---

## Model logic & features

The app uses the logistic function:

$$
p = \sigma(\beta_0 + \sum_k \beta_k x_k)
$$

Features generated by the UI:

* `female` (1 if Female else 0)
* `age_ge70` (1 if age ≥ 70)
* `scheduled_admission` (1 if Scheduled else 0)
* `warm_month` (1 if admission month ∈ {Mar, Apr, May, Jun, Jul, Aug})
* Comorbidity indicators (0/1):

  * `comorb_neoplasm`, `comorb_blood`, `comorb_endocrine`,
    `comorb_circulatory`, `comorb_respiratory`, `comorb_digestive`

---

## `data/model_coeffs.json` schema (minimal example)

```json
{
  "outcomes": {
    "death_in_hospital": {
      "intercept": -3.21,
      "coeffs": {
        "female": -0.12,
        "age_ge70": 0.65,
        "scheduled_admission": -0.40,
        "warm_month": -0.08,
        "comorb_neoplasm": 0.22,
        "comorb_blood": 0.10,
        "comorb_endocrine": 0.15,
        "comorb_circulatory": 0.30,
        "comorb_respiratory": 0.18,
        "comorb_digestive": 0.12
      }
    },
    "prolonged_los": {
      "intercept": -0.90,
      "coeffs": {
        "female": -0.05,
        "age_ge70": 0.40,
        "scheduled_admission": -0.25,
        "warm_month": -0.03,
        "comorb_neoplasm": 0.10,
        "comorb_blood": 0.06,
        "comorb_endocrine": 0.12,
        "comorb_circulatory": 0.20,
        "comorb_respiratory": 0.14,
        "comorb_digestive": 0.09
      }
    }
  }
}
```

> Replace numbers with your fitted coefficients. Keys in `coeffs` must match the feature names above.

---

## Implementation notes

* **Caching:** `data/model_coeffs.json` is loaded with `st.cache_data` and reloads automatically when the file changes.
* **Session-only state:** No inputs are persisted; everything lives in the current browser session.
* **Mobile-first UI:** Fluid typography, unified buttons, and compact layout for small screens.
* **Eligibility gate:** The calculator is intended **only** when CKD (ICD-10 N18.\*) is the primary diagnosis.

---

```

